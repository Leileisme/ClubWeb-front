import{y as z,z as G,x as L,ac as O,A as $,o as P,T as q,W as H,B as I,a4 as J,D as f,H as _,v as e,F as t,J as y,Z as Q,N as W,L as l,_ as Y,P as Z,G as u,Y as T,Q as c,I as w,aa as V,ab as C,a0 as X,a1 as ee}from"./index-b2b635a8.js";import{u as te,a as se,V as ae}from"./vee-validate.esm-f268b922.js";import{B as b}from"./BlankLine-122a157e.js";import{_ as A}from"./InfoAll-b519c9df.js";import{T as r}from"./TicketUseState-e7a697a0.js";import{u as le}from"./mitt-43e253ae.js";import{_ as oe}from"./_plugin-vue_export-helper-c27b6911.js";import{V as ne}from"./VContainer-2abc6ac8.js";import{V as i}from"./VRow-52b84734.js";import{V as a}from"./VCol-c740c829.js";import"./VDivider-6035405a.js";const ce=p=>(X("data-v-5a8da093"),p=p(),ee(),p),ue=ce(()=>T("span",{style:{color:"#25ECE0"},class:"font-weight-bold"},"登記票券",-1)),re={style:{color:"#aaa"}},ie={style:{color:"#aaa"}},de={__name:"TicketUsed",setup(p){z();const N=G(),R=L(),{apiAuth:h}=Q(),d=O("routeEvent"),U=le(),{xs:D}=$();P(()=>D.value);const M=q({ticketId:H().required("票券編號必填")}),{handleSubmit:B,isSubmitting:K}=te({validationSchema:M}),m=se("ticketId"),j=B(async g=>{var n,s;try{const v=(await h.patch("/events/"+N.params.id+"/useTicket",{ticketId:g.ticketId,used:r.USED})).data.USER_NAME;await h.patch("/users/usedTicket",{USER_NAME:v,TICKET_CART:{TICKET:g.ticketId,USED:r.USED}}),await R.getProfile(),U.emit("updateEvent"),U.on("updateEventOk",async()=>{E.value=!0,m.value.value=""})}catch(o){console.log(o);const v=((s=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:s.message)||"發生錯誤，請稍後再試";k.value=v,S.value=!0}}),E=I(!1),F=I("登記成功！"),S=I(!1),k=I(""),x=()=>{S.value=!1,E.value=!1};return J(async()=>{console.log(d.value)}),(g,n)=>(f(),_(y,null,[e(ne,null,{default:t(()=>[e(i,null,{default:t(()=>[e(b,{style:{"margin-top":"1rem"}}),e(a,{cols:"12"},{default:t(()=>[ue]),_:1}),e(a,{cols:"12",style:{"padding-top":"0","padding-bottom":"0"}},{default:t(()=>[e(ae,{onSubmit:W(l(j),["prevent"]),disabled:l(K)},{default:t(()=>[e(i,{class:"d-flex justify-center"},{default:t(()=>[e(a,{cols:"9"},{default:t(()=>[e(Y,{modelValue:l(m).value.value,"onUpdate:modelValue":n[0]||(n[0]=s=>l(m).value.value=s),"error-messages":l(m).errorMessage.value,label:"輸入票券編號",type:"text",counter:"",color:"#25ECE0",variant:"outlined"},null,8,["modelValue","error-messages"])]),_:1}),e(a,{cols:"3",style:{"margin-top":"5px"}},{default:t(()=>[e(Z,{type:"submit",block:"",class:"rounded-lg",style:{"background-color":"#1BBCA9","font-weight":"900",height:"45px"}},{default:t(()=>[u(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1}),e(b),e(a,{cols:"12",style:{color:"#25ECE0"},class:"font-weight-bold"},{default:t(()=>[u(" 未入場名單 "),T("span",re,"( 共 "+c(l(d).TICKET.filter(s=>s.USED===l(r).N_USE).length)+" 人 )",1)]),_:1}),e(a,{cols:"12"},{default:t(()=>[(f(!0),_(y,null,w(l(d).TICKET.filter(s=>s.USED===l(r).N_USE),(s,o)=>(f(),_("div",{key:o},[e(i,null,{default:t(()=>[e(a,{cols:"1"},{default:t(()=>[u(c(o+1)+".",1)]),_:2},1024),e(a,{cols:"1",class:"d-flex justify-center align-center me-3",style:{height:"45px"}},{default:t(()=>[e(V,{size:"250%"},{default:t(()=>[e(C,{src:s.USER.IMAGE},null,8,["src"])]),_:2},1024)]),_:2},1024),e(a,{cols:"9",class:"d-flex justify-center align-center"},{default:t(()=>[e(i,null,{default:t(()=>[e(a,{cols:"12",style:{padding:"0",margin:"0"}},{default:t(()=>[u(c(s.USER.NICK_NAME)+" ("+c(s.USER.USER_NAME)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1}),e(a,{cols:"12",style:{color:"#25ECE0"},class:"font-weight-bold"},{default:t(()=>[u(" 已入場名單 "),T("span",ie,"( 共 "+c(l(d).TICKET.filter(s=>s.USED===l(r).USED).length)+" 人 )",1)]),_:1}),e(a,{cols:"12"},{default:t(()=>[(f(!0),_(y,null,w(l(d).TICKET.filter(s=>s.USED===l(r).USED),(s,o)=>(f(),_("div",{key:o},[e(i,null,{default:t(()=>[e(a,{cols:"1"},{default:t(()=>[u(c(o+1)+".",1)]),_:2},1024),e(a,{cols:"1",class:"d-flex justify-center align-center me-3",style:{height:"45px"}},{default:t(()=>[e(V,{size:"250%"},{default:t(()=>[e(C,{src:s.USER.IMAGE},null,8,["src"])]),_:2},1024)]),_:2},1024),e(a,{cols:"9",class:"d-flex justify-center align-center"},{default:t(()=>[e(i,null,{default:t(()=>[e(a,{cols:"12",style:{padding:"0",margin:"0"}},{default:t(()=>[u(c(s.USER.NICK_NAME)+" ("+c(s.USER.USER_NAME)+")",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),_:1})]),_:1}),e(A,{InfoSwitch:E.value,InfoText:F.value,closeInfo:x,"onUpdate::InfoSwitch":n[1]||(n[1]=s=>E.value=s)},null,8,["InfoSwitch","InfoText"]),e(A,{InfoSwitch:S.value,InfoText:k.value,closeInfo:x,"onUpdate:InfoSwitch":n[2]||(n[2]=s=>S.value=s)},null,8,["InfoSwitch","InfoText"])],64))}},he=oe(de,[["__scopeId","data-v-5a8da093"]]);export{he as default};
